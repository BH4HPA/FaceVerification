<!DOCTYPE html>

<!--
+-----------------------------------------------------------------------------
|   __              __     __        _  __ _           _   _
|  / _| __ _  ___ __\ \   / /__ _ __(_)/ _(_) ___ __ _| |_(_) ___  _ __
| | |_ / _` |/ __/ _ \ \ / / _ \ '__| | |_| |/ __/ _` | __| |/ _ \| '_ \
| |  _| (_| | (_|  __/\ V /  __/ |  | |  _| | (_| (_| | |_| | (_) | | | |
| |_|  \__,_|\___\___| \_/ \___|_|  |_|_| |_|\___\__,_|\__|_|\___/|_| |_|
|
| faceVerification - 腾讯云人脸识别的上机体验
+-----------------------------------------------------------------------------
| WebSite Author: LF112 [https://www.lf112.net]
+-----------------------------------------------------------------------------
-->

<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="author" content="LF112">
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <title>
        faceVerification - 腾讯云人脸识别的上机体验
    </title>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://www.zhihu.com">
    <link rel="dns-prefetch" href="https://ae01.alicdn.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web|Ubuntu:400,700">
    <link rel="stylesheet" href="Fv.website.css">
</head>

<body>

    <video id="Fv-Video" width="0" height="0" autoplay hidden></video>
    <canvas id="Fv-Canvas" width="640" height="480" hidden></canvas>
    <main>
        <div id="tryVerifyButton" style="position:absolute;cursor:pointer;width:80px;height:25px;margin-top: 20%;margin-left: 230px;letter-spacing:.05em;text-align:center;font-size:12px;line-height:2.2;color: #fff;border-radius: 2px;background:rgba(51,51,51,.82)!important;">尝试验证</div>
        <div id="addImageButton" style="position:absolute;cursor:pointer;width:80px;height:25px;margin-top: 20%;margin-left: 145px;letter-spacing:.05em;text-align:center;font-size:12px;line-height:2.2;color: #fff;border-radius: 2px;background:rgba(51,51,51,.82)!important;">增加图像</div>
        <div id="delMemberButton" style="position:absolute;cursor:pointer;width:80px;height:25px;margin-top: 20%;margin-left: 60px;letter-spacing:.05em;text-align:center;font-size:12px;line-height:2.2;color: #fff;border-radius: 2px;background:rgba(51,51,51,.82)!important;">删除用户</div>
        <div id="addMemberButton" style="position:absolute;cursor:pointer;width:80px;height:25px;margin-top: 20%;margin-left: -25px;letter-spacing:.05em;text-align:center;font-size:12px;line-height:2.2;color: #fff;border-radius: 2px;background:rgba(51,51,51,.82)!important;">新增用户</div>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="Fv.app.js"></script>
    <script>
        var isAccessed = false;
        var userid = 'test';
        function getPhotoAccess() { //获取摄像头权限并开始拍照方便取像
            if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
                    //video.src = window.URL.createObjectURL(stream);
                    var video = document.getElementById('Fv-Video');
                    video.srcObject = stream;
                    while(stream == null) isAccessed = false;
                    isAccessed = true;
                    video.play();
                });
            }
        }
        function takePhoto() { //直接拍照
            if (isAccessed){
                var canvas = document.getElementById('Fv-Canvas');
                var context = canvas.getContext('2d');
                var video = document.getElementById('Fv-Video');
                context.drawImage(video, 0, 0, 640, 480);
                return encodeURIComponent(canvas.toDataURL('image/jpeg').split(",")[1]);
            }else return '';
        }
        getPhotoAccess(); //向用户要权限
        window.onload = function() {
            $('#addMemberButton').click(function() {
                Fv('main', {
                    fun: 1,
                    file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                    check: [true, function(ID) {
                        // Fun Callback
                    }]
                }, function(ID) {
                    /* Callback */
                    setTimeout( function(){
                        var isSuccess = false;
                        var imgData = takePhoto();
                        if(imgData !== ''){
                            $.ajax({
                                type: 'post',
                                url: '../core.php',
                                data: 'access=Ray&method=addMember&personID=' + userid + '&image=' + imgData,
                                cache: false,
                                dataType: 'json',
                                success: function (data) {
                                    if (data['code'] === 2) {
                                        isSuccess = true;
                                        console.log(data['Info']);
                                    } else {
                                        isSuccess = false;
                                        console.warn(data['Response']['Error']['Message']);
                                    }
                                },
                                error: function () {
                                    isSuccess = false;
                                }
                            })
                        }else isSuccess = false;
                        //-----------
                        if(isSuccess){
                            Fv('main', {
                                fun: 2,
                                file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                                check: [true, function(ID) {
                                    // Fun Callback
                                }]
                            }, function(ID) {
                                /* Callback */
                                setTimeout(function() {
                                    $('#' + ID[1]).fadeOut(500);
                                    setTimeout(function() {
                                        $('#' + ID[0]).remove()
                                    }, 500);
                                },1700);
                            });
                        }else{
                            Fv('main', {
                                fun: 2,
                                file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                                check: [false, function(ID) {
                                    // Fun Callback
                                }]
                            }, function(ID) {
                                /* Callback */
                                setTimeout(function() {
                                    $('#' + ID[1]).fadeOut(500);
                                    setTimeout(function() {
                                        $('#' + ID[0]).remove()
                                    }, 500);
                                },1100);
                            });
                        }
                        $('#' + ID[1]).fadeOut(500);
                        setTimeout(function() {
                            $('#' + ID[0]).remove()
                        }, 500);
                    },1000)
                });
            });

            $('#delMemberButton').click(function() {
                Fv('main', {
                    fun: 1,
                    file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                    check: [true, function(ID) {
                        // Fun Callback
                    }]
                }, function(ID) {
                    /* Callback */
                    setTimeout( function(){
                        var isSuccess = false;
                        if(imgData !== ''){
                            $.ajax({
                                type: 'post',
                                url: '../core.php',
                                data: 'access=Ray&method=delMember&personID=' + userid,
                                cache: false,
                                dataType: 'json',
                                success: function (data) {
                                    if (data['code'] === 2) {
                                        isSuccess = true;
                                        console.log(data['Info']);
                                    } else {
                                        isSuccess = false;
                                        console.warn(data['Response']['Error']['Message']);
                                    }
                                },
                                error: function () {
                                    isSuccess = false;
                                }
                            })
                        }else isSuccess = false;
                        //-----------
                        if(isSuccess){
                            Fv('main', {
                                fun: 2,
                                file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                                check: [true, function(ID) {
                                    // Fun Callback
                                }]
                            }, function(ID) {
                                /* Callback */
                                setTimeout(function() {
                                    $('#' + ID[1]).fadeOut(500);
                                    setTimeout(function() {
                                        $('#' + ID[0]).remove()
                                    }, 500);
                                },1700);
                            });
                        }else{
                            Fv('main', {
                                fun: 2,
                                file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                                check: [false, function(ID) {
                                    // Fun Callback
                                }]
                            }, function(ID) {
                                /* Callback */
                                setTimeout(function() {
                                    $('#' + ID[1]).fadeOut(500);
                                    setTimeout(function() {
                                        $('#' + ID[0]).remove()
                                    }, 500);
                                },1100);
                            });
                        }
                        $('#' + ID[1]).fadeOut(500);
                        setTimeout(function() {
                            $('#' + ID[0]).remove()
                        }, 500);
                    },1000)
                });
            });

            $('#addImageButton').click(function() {
                Fv('main', {
                    fun: 1,
                    file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                    check: [true, function(ID) {
                        // Fun Callback
                    }]
                }, function(ID) {
                    /* Callback */
                    setTimeout( function(){
                        var isSuccess = false;
                        var imgData = takePhoto();
                        if(imgData !== ''){
                            $.ajax({
                                type: 'post',
                                url: '../core.php',
                                data: 'access=Ray&method=addImage&personID=' + userid + '&image=' + imgData,
                                cache: false,
                                dataType: 'json',
                                success: function (data) {
                                    if (data['code'] === 2) {
                                        isSuccess = true;
                                        console.log(data['Info']);
                                    } else {
                                        isSuccess = false;
                                        console.warn(data['Response']['Error']['Message']);
                                    }
                                },
                                error: function () {
                                    isSuccess = false;
                                }
                            })
                        }else isSuccess = false;
                        //-----------
                        if(isSuccess){
                            Fv('main', {
                                fun: 2,
                                file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                                check: [true, function(ID) {
                                    // Fun Callback
                                }]
                            }, function(ID) {
                                /* Callback */
                                setTimeout(function() {
                                    $('#' + ID[1]).fadeOut(500);
                                    setTimeout(function() {
                                        $('#' + ID[0]).remove()
                                    }, 500);
                                },1700);
                            });
                        }else{
                            Fv('main', {
                                fun: 2,
                                file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                                check: [false, function(ID) {
                                    // Fun Callback
                                }]
                            }, function(ID) {
                                /* Callback */
                                setTimeout(function() {
                                    $('#' + ID[1]).fadeOut(500);
                                    setTimeout(function() {
                                        $('#' + ID[0]).remove()
                                    }, 500);
                                },1100);
                            });
                        }
                        $('#' + ID[1]).fadeOut(500);
                        setTimeout(function() {
                            $('#' + ID[0]).remove()
                        }, 500);
                    },1000)
                });
            });

            $('#tryVerifyButton').click(function() {
                Fv('main', {
                    fun: 1,
                    file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                    check: [true, function(ID) {
                        // Fun Callback
                    }]
                }, function(ID) {
                    /* Callback */
                    setTimeout( function(){
                        var isSuccess = false;
                        var imgData = takePhoto();
                        if(imgData !== ''){
                            $.ajax({
                                type: 'post',
                                url: '../core.php',
                                data: 'access=Ray&method=verfMember&personID=' + userid + '&image=' + imgData,
                                cache: false,
                                dataType: 'json',
                                success: function (data) {
                                    if (data['code'] === 2) {
                                        isSuccess = true;
                                        console.log(data['Info']);
                                    } else {
                                        isSuccess = false;
                                        console.warn(data['Response']['Error']['Message']);
                                    }
                                },
                                error: function () {
                                    isSuccess = false;
                                }
                            })
                        }else isSuccess = false;
                        //-----------
                        if(isSuccess){
                            Fv('main', {
                                fun: 2,
                                file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                                check: [true, function(ID) {
                                    // Fun Callback
                                }]
                            }, function(ID) {
                                /* Callback */
                                setTimeout(function() {
                                    $('#' + ID[1]).fadeOut(500);
                                    setTimeout(function() {
                                        $('#' + ID[0]).remove()
                                    }, 500);
                                },1700);
                            });
                        }else{
                            Fv('main', {
                                fun: 2,
                                file: ['./gifs/faceid.png', './gifs/faceid.gif', './gifs/faceid_fail.gif'],
                                check: [false, function(ID) {
                                    // Fun Callback
                                }]
                            }, function(ID) {
                                /* Callback */
                                setTimeout(function() {
                                    $('#' + ID[1]).fadeOut(500);
                                    setTimeout(function() {
                                        $('#' + ID[0]).remove()
                                    }, 500);
                                },1100);
                            });
                        }
                        $('#' + ID[1]).fadeOut(500);
                        setTimeout(function() {
                            $('#' + ID[0]).remove()
                        }, 500);
                    },1000)
                });
            });



        }
    </script>
</body>

<!-- Made By LF112, Created and produced the project by Ray. -->

</html>
